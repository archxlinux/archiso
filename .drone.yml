kind: pipeline
name: build and publish
steps:
  - name: build
    image: archxlinux/iso
    pull: always
    privileged: true
    commands:
      - bash /entrypoint.sh
    volumes:
    - name: build
      path: /tmp/build 
    - name: iso
      path: /tmp/iso 
  - name: login
    image: ghcr.io/supportpal/github-gh-cli 
    commands: 
      - gh auth login --with-token $GITHUB_TOKEN
      - gh release create $(git log -1 --pretty='%ad' --date=format:'%Y.%m.%d') /tmp/iso/*
    volumes:
    - name: build
      path: /tmp/build 
    - name: iso
      path: /tmp/iso 

volumes:
- name: build
  temp: {}
- name: iso
  temp: {}
- name: temp-repo
  temp: {}
